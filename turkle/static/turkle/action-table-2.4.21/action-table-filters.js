var x=Object.defineProperty;var y=(g,p,e)=>p in g?x(g,p,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[p]=e;var E=(g,p,e)=>(y(g,typeof p!="symbol"?p+"":p,e),e);class A extends HTMLElement{constructor(){super();E(this,"options",[])}findOptions(e){e=e.toLowerCase();const t=this.closest("action-table"),o=t.cols,n=t.tbody,s=o.findIndex(i=>i.name===e);if(s===-1)return;const h=`td:nth-child(${s+1})`,u=n.querySelectorAll(h);let a=[];Array.from(u).forEach(i=>{const l=i.querySelectorAll("span, ul > li");if(!i.dataset.filter&&(l==null?void 0:l.length)>0){const d=Array.from(l).map(f=>f.textContent||"");a=a.concat(d)}else a.push(t.getCellValues(i).filter)}),a=Array.from(new Set(a));const r=o[s].order;function c(i){return r!=null&&r.includes(i)?r.indexOf(i).toString():i}a.sort((i,l)=>(i=c(i),l=c(l),t.alphaNumSort(i,l))),this.hasAttribute("descending")&&a.reverse(),this.options=a}connectedCallback(){var t;const e=this.getAttribute("name");e&&(this.hasAttribute("options")?this.options=((t=this.getAttribute("options"))==null?void 0:t.split(","))||[]:this.findOptions(e),this.render(e))}render(e){if(this.options.length<1)return;const t=this.getAttribute("type")||"select";if(t!=="checkbox"&&this.options.length<2)return;const o=this.getAttribute("label")||e,n=this.hasAttribute("multiple")?"multiple":"",s=this.getAttribute("all")||"All";let h="",u="";const a=t==="select"?`<label for="filter-${e}">${o}</label>`:`<span class="filter-label">${o}</span>`;t==="select"&&(h=`<select id="filter-${e}" name="${e}" ${n}><option value="">${s}</option>`,u="</select>"),t==="radio"&&(h=`<label><input name="${e}" type="radio" value="" checked>${s}</label>`);const r=`${a}${h}${this.options.map(c=>t==="select"?`<option value="${c}">${c}</option>`:t==="radio"||t==="checkbox"?`<label><input type="${t}" name="${e}" value="${c}" />${c}</label>`:"").join("")}${u}`;this.innerHTML=`${r}`}}customElements.define("action-table-filter-menu",A);class L extends HTMLElement{connectedCallback(){const p=this.getAttribute("name");p&&(this.innerHTML=`<label>
            <input type="checkbox" name="${p.toLowerCase()}" value="${this.getAttribute("value")||"on"}" />
            <span>${this.getAttribute("label")||p}</span>
          </label>`)}}customElements.define("action-table-filter-switch",L);class T extends HTMLElement{constructor(){super();E(this,"min",0);E(this,"rangeTotal",0);this.render(),this.addEventListeners()}get name(){return this.getAttribute("name")||""}addEventListeners(){this.addEventListener("input",e=>{const t=this.querySelectorAll("input"),o=this.querySelector("output"),[n,s]=Array.from(t).map(r=>Number(r.value)),h=n.toString(),u=s.toString();o instanceof HTMLOutputElement&&(o.textContent=`${h}-${u}`);const a=this.querySelector(".range-slider-highlight");a instanceof HTMLSpanElement&&(a.style.marginLeft=`${(n-this.min)/this.rangeTotal*100}%`,a.style.width=`${(s-n)/this.rangeTotal*100}%`),n>s&&(e.stopPropagation(),t[0].value=u,t[1].value=h)})}findMinMax(){const e=this.getAttribute("min"),t=this.getAttribute("max");if(e&&t)return[Number(e),Number(t)];const o=this.closest("action-table"),n=o.cols,s=o.tbody,h=n.findIndex(r=>r.name===this.name.toLowerCase());if(h===-1)return[0,0];const u=`td:nth-child(${h+1})`,a=s.querySelectorAll(u);return Array.from(a).reduce((r,c)=>{const i=Number(o.getCellValues(c).filter);let l=r.length===2?r[0]:i,d=r.length===2?r[1]:i;return l=l<i?l:i,d=d>i?d:i,[l,d]},[])}render(){const[e,t]=this.findMinMax(),o=e.toString(),n=t.toString();this.rangeTotal=t-e,this.min=e;const s=this.getAttribute("label")||this.name,h=document.createElement("div");h.textContent=s;const u=document.createElement("div");u.classList.add("range-slider-group");const a=Math.pow(10,Math.round(Math.log10(this.rangeTotal)))/10;function r(m,b){for(const v in b)m.setAttribute(v,b[v])}const c=[e];for(let m=e+a;m<=t;m+=a)c.push(Math.round(m/a)*a);c.includes(t)||c.push(t);const i=document.createElementNS("http://www.w3.org/2000/svg","svg");r(i,{role:"presentation",width:"100%",height:"5"});const l=100/(c.length-1);for(let m=1;m<c.length-1;m++){const b=document.createElementNS("http://www.w3.org/2000/svg","line"),v=`${m*l}%`;r(b,{x1:v,x2:v,y1:"0",y2:"5",stroke:"currentColor","stroke-width":"1"}),i.append(b)}const d=document.createElement("span");d.classList.add("range-slider-highlight"),u.append(i,d);for(let m=0;m<=1;m++){const b=document.createElement("input");r(b,{type:"range",name:this.name,min:o,max:n,"data-range":m===0?"min":"max","aria-label":m===0?"Min":"Max",value:m===0?o:n}),u.append(b)}const f=document.createElement("output");f.innerHTML=`${e}&ndash;${t}`,this.append(h,u,f)}}customElements.define("action-table-filter-range",T);class $ extends HTMLElement{constructor(){super();E(this,"actionTable",this.closest("action-table"));E(this,"resetButton",this.querySelector("button[type=reset]"));this.addEventListeners()}connectedCallback(){const e=this.actionTable.filters;Object.keys(e).length>0&&this.setFilterElements(e)}toggleHighlight(e){e.value?e.classList.add("selected"):e.classList.remove("selected")}addEventListeners(){var o;const e=(n,s)=>n.hasAttribute(s)||!!n.closest(`[${s}]`);this.addEventListener("input",n=>{const s=n.target;if(s instanceof HTMLSelectElement||s instanceof HTMLInputElement){const h=e(s,"exclusive"),u=e(s,"regex"),a=e(s,"exact"),r=s.dataset.cols?s.dataset.cols.toLowerCase().split(","):void 0,c=s.name.toLowerCase();if(s instanceof HTMLSelectElement){this.toggleHighlight(s);const i=Array.from(s.selectedOptions).map(l=>l.value);this.dispatch({[c]:{values:i,exclusive:h,regex:u,exact:a,cols:r}})}if(s instanceof HTMLInputElement){if(s.type==="checkbox"){const i=this.querySelectorAll("input[type=checkbox][name="+s.name+"]"),l=Array.from(i).filter(d=>d.checked).map(d=>d.value);this.dispatch({[c]:{values:l,exclusive:h,regex:u,exact:a,cols:r}})}if(s.type==="radio"&&this.dispatch({[c]:{values:[s.value],exclusive:h,regex:u,exact:a,cols:r}}),s.type==="range"){const i=this.querySelectorAll("input[type=range][name='"+s.name+"']");let l=[];const d=[];i.forEach(f=>{f.dataset.range==="min"&&(d[0]=f.min,l[0]=f.value),f.dataset.range==="max"&&(d[1]=f.max,l[1]=f.value)}),l.every((f,m)=>f===d[m])&&(l=[]),this.dispatch({[c]:{values:l,range:!0}})}}}}),this.querySelectorAll("input[type='search']").forEach(n=>{function s(u,a=300){let r;return(...c)=>{clearTimeout(r),r=setTimeout(()=>{u(...c)},a)}}const h=n.dataset.event||"input";n.addEventListener(h,()=>{this.toggleHighlight(n);const u=e(n,"exclusive"),a=e(n,"regex"),r=e(n,"exact"),c=n.dataset.cols?n.dataset.cols.toLowerCase().split(","):void 0;s(()=>this.dispatch({[n.name]:{values:[n.value],exclusive:u,regex:a,exact:r,cols:c}}))()})}),(o=this.resetButton)==null||o.addEventListener("click",()=>{this.resetAllFilterElements(),this.dispatch()}),this.actionTable.addEventListener("action-table-filters-reset",()=>{this.resetAllFilterElements()})}dispatchInput(e){e.dispatchEvent(new Event("input",{bubbles:!0}))}dispatch(e){if(this.resetButton)if(e){let t=this.actionTable.filters||{};t={...t,...e},this.enableReset(this.hasFilters(t))}else this.enableReset(!1);this.dispatchEvent(new CustomEvent("action-table-filter",{detail:e,bubbles:!0}))}enableReset(e=!0){this.resetButton&&(e?this.resetButton.removeAttribute("disabled"):this.resetButton.setAttribute("disabled",""))}hasFilters(e){return Object.keys(e).some(t=>e[t].values.some(o=>o!==""))}resetAllFilterElements(){this.querySelectorAll("select, input").forEach(t=>{t instanceof HTMLInputElement&&(t.type==="checkbox"||t.type==="radio")&&(t.value===""?t.checked=!0:t.checked=!1),(t instanceof HTMLSelectElement||t instanceof HTMLInputElement&&t.type==="search")&&(t.value="",this.toggleHighlight(t)),t instanceof HTMLInputElement&&t.type==="range"&&(t.value=t.dataset.range==="max"?t.max:t.min,this.dispatchInput(t))})}setFilterElements(e){this.hasFilters(e)?(this.enableReset(),Object.keys(e).forEach(t=>this.setFilterElement(t,e[t].values))):this.resetAllFilterElements()}setSelectValueIgnoringCase(e,t){t=t.toLowerCase(),Array.from(e.options).some(o=>(o.value.toLowerCase()||o.text.toLowerCase())===t?(o.selected=!0,this.toggleHighlight(e),!0):!1)}setFilterElement(e,t){if(t.length===0)return;this.querySelectorAll(`select[name="${e}" i], input[name="${e}" i]`).forEach(n=>{n instanceof HTMLSelectElement&&(n.value=t[0],this.setSelectValueIgnoringCase(n,t[0])),n instanceof HTMLInputElement&&(n.type==="checkbox"&&t.includes(n.value)&&(n.checked=!0),n.type==="radio"&&n.value===t[0]&&(n.checked=!0),n.type==="search"&&(n.value=t[0],this.toggleHighlight(n)),n.type==="range"&&(n.dataset.range==="min"&&(n.value=t[0]||n.min,this.dispatchInput(n)),n.dataset.range==="max"&&(n.value=t[1]||n.max,this.dispatchInput(n))))})}}customElements.define("action-table-filters",$);
//# sourceMappingURL=action-table-filters.js.map
